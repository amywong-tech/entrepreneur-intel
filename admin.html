<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åå°ç®¡ç† - å†…å®¹ç”Ÿæˆå™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            -webkit-font-smoothing: antialiased;
            background: #f5f5f7;
            color: #000000;
        }

        .panel {
            background: white;
            border-radius: 8px;
            border: 1px solid #e5e5e7;
        }

        textarea {
            resize: vertical;
        }

        .loading {
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .preview-card {
            border-left: 3px solid #000;
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <nav class="bg-white border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <h1 class="text-xl font-semibold">åå°ç®¡ç†</h1>
                <span class="text-xs text-gray-500">AIå†…å®¹ç”Ÿæˆå™¨</span>
            </div>
            <a href="frontend-v2.html" class="text-sm text-black hover:text-gray-600 underline">æŸ¥çœ‹å‰å°</a>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-6 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- å·¦ä¾§ï¼šè¾“å…¥åŒº -->
            <div class="space-y-6">
                <!-- å¿«é€Ÿç”Ÿæˆ -->
                <div class="panel p-6">
                    <h2 class="text-lg font-semibold mb-4">å¿«é€Ÿç”Ÿæˆå†…å®¹</h2>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">è¾“å…¥åŸå§‹æ–°é—»/é“¾æ¥</label>
                        <textarea 
                            id="rawInput" 
                            rows="6" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:border-black"
                            placeholder="ç²˜è´´æ–°é—»æ ‡é¢˜ã€æ‘˜è¦æˆ–ç½‘å€...&#10;&#10;ä¾‹å¦‚ï¼š&#10;OpenAIä»Šæ—¥å®£å¸ƒGPT-5è¿›å…¥å†…æµ‹é˜¶æ®µï¼Œæ€§èƒ½å¤§å¹…æå‡..."
                        ></textarea>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">é€‰æ‹©åˆ†ç±»</label>
                        <select id="categorySelect" class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:border-black">
                            <option value="ai">AIåˆ›æ–°</option>
                            <option value="trade">ä¸­å¤–è´¸æ˜“</option>
                            <option value="policy">å›½å†…æ”¿ç­–</option>
                            <option value="cn-finance">ä¸­å›½é‡‘è</option>
                            <option value="global-finance">æµ·å¤–é‡‘è</option>
                        </select>
                    </div>

                    <button 
                        onclick="generateContent()" 
                        id="generateBtn"
                        class="w-full py-3 bg-black text-white rounded-md hover:bg-gray-800 transition-colors font-medium"
                    >
                        AI ç”Ÿæˆç»“æ„åŒ–å†…å®¹
                    </button>
                </div>

                <!-- æ‰¹é‡ç”Ÿæˆ -->
                <div class="panel p-6">
                    <h2 class="text-lg font-semibold mb-4">æ‰¹é‡ç”Ÿæˆï¼ˆæ¯æ—¥æ‘˜è¦ï¼‰</h2>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">è¾“å…¥å¤šæ¡æ–°é—»ï¼ˆæ¯è¡Œä¸€æ¡ï¼‰</label>
                        <textarea 
                            id="batchInput" 
                            rows="8" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:border-black"
                            placeholder="æ¯è¡Œè¾“å…¥ä¸€æ¡æ–°é—»æ ‡é¢˜æˆ–æ‘˜è¦ï¼š&#10;&#10;1. GPT-5å¼€å¯å†…æµ‹ï¼Œæ€§èƒ½æå‡3å€&#10;2. å•†åŠ¡éƒ¨æ”¾å®½èŠ¯ç‰‡å‡ºå£ç®¡åˆ¶&#10;3. Aè‚¡ç§‘æŠ€æ¿å—æ¶¨å¹…è¶…8%&#10;..."
                        ></textarea>
                    </div>

                    <button 
                        onclick="generateBatch()" 
                        id="batchBtn"
                        class="w-full py-3 bg-black text-white rounded-md hover:bg-gray-800 transition-colors font-medium"
                    >
                        æ‰¹é‡ç”Ÿæˆï¼ˆ3-5æ¡ï¼‰
                    </button>
                </div>

                <!-- API é…ç½® -->
                <div class="panel p-6">
                    <h2 class="text-lg font-semibold mb-4">é‚®ä»¶æ¨é€è®¾ç½®</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">æ¥æ”¶é‚®ç®±</label>
                            <input 
                                type="email" 
                                id="emailInput"
                                value="amy@cozmox.com"
                                class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:border-black"
                                placeholder="è¾“å…¥æ¥æ”¶é‚®ç®±"
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">æ¨é€æ—¶é—´</label>
                            <input 
                                type="time" 
                                id="pushTime"
                                value="08:00"
                                class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:border-black"
                            >
                            <div class="text-xs text-gray-500 mt-1">æ¯å¤©å®šæ—¶å‘é€</div>
                        </div>

                        <button 
                            onclick="testEmail()" 
                            class="w-full py-3 bg-white border border-gray-300 rounded-md hover:bg-gray-50 font-medium"
                        >
                            ğŸ“§ æµ‹è¯•å‘é€
                        </button>

                        <button 
                            onclick="saveEmailSettings()" 
                            class="w-full py-3 bg-black text-white rounded-md hover:bg-gray-800 font-medium"
                        >
                            ä¿å­˜è®¾ç½®
                        </button>
                    </div>
                </div>

                <div class="panel p-6">
                    <h2 class="text-lg font-semibold mb-4">è¯´æ˜</h2>
                    <div class="text-sm text-gray-600 space-y-2">
                        <p><strong>åŠŸèƒ½ï¼š</strong></p>
                        <p>â€¢ è¾“å…¥åŸå§‹æ–°é—»ï¼ŒAIè‡ªåŠ¨ç”Ÿæˆç»“æ„åŒ–å†…å®¹</p>
                        <p>â€¢ åŒ…å«ï¼šæ ¸å¿ƒæ‘˜è¦ã€è¦ç‚¹ã€å»ºè®®ã€é£é™©æç¤º</p>
                        <p>â€¢ æ”¯æŒæ‰¹é‡å¤„ç†ï¼Œä¸€æ¬¡ç”Ÿæˆå¤šæ¡</p>
                        <br>
                        <p><strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong></p>
                        <p>1. ç²˜è´´æ–°é—»å†…å®¹åˆ°è¾“å…¥æ¡†</p>
                        <p>2. é€‰æ‹©åˆ†ç±»ï¼ˆAI/è´¸æ˜“/æ”¿ç­–/é‡‘èï¼‰</p>
                        <p>3. ç‚¹å‡»ç”ŸæˆæŒ‰é’®</p>
                        <p>4. é¢„è§ˆå¹¶å¤åˆ¶JSONæ•°æ®</p>
                        <p>5. ç²˜è´´åˆ° data/today.json æ–‡ä»¶</p>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§ï¼šé¢„è§ˆåŒº -->
            <div class="space-y-6">
                <!-- ç”Ÿæˆç»“æœé¢„è§ˆ -->
                <div class="panel p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-semibold">ç”Ÿæˆç»“æœé¢„è§ˆ</h2>
                        <button 
                            onclick="copyJSON()" 
                            id="copyBtn"
                            class="px-4 py-2 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-50"
                        >
                            å¤åˆ¶ JSON
                        </button>
                    </div>

                    <div id="previewArea" class="space-y-4">
                        <div class="text-center py-12 text-gray-400">
                            ç­‰å¾…ç”Ÿæˆå†…å®¹...
                        </div>
                    </div>
                </div>

                <!-- JSON è¾“å‡º -->
                <div class="panel p-6">
                    <h2 class="text-lg font-semibold mb-4">JSON æ•°æ®</h2>
                    <textarea 
                        id="jsonOutput" 
                        rows="15" 
                        readonly
                        class="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-md font-mono text-xs"
                        placeholder="ç”Ÿæˆçš„ JSON æ•°æ®å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."
                    ></textarea>
                </div>

                <!-- å†å²è®°å½• -->
                <div class="panel p-6">
                    <h2 class="text-lg font-semibold mb-4">ä»Šæ—¥å·²ç”Ÿæˆï¼ˆ<span id="todayCount">0</span>æ¡ï¼‰</h2>
                    <div id="historyList" class="space-y-2 max-h-60 overflow-y-auto">
                        <div class="text-sm text-gray-400">æš‚æ— è®°å½•</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let generatedItems = [];
        let todayHistory = JSON.parse(localStorage.getItem('todayHistory') || '[]');

        // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
        function updateHistory() {
            const container = document.getElementById('historyList');
            const count = document.getElementById('todayCount');
            
            count.textContent = todayHistory.length;
            
            if (todayHistory.length === 0) {
                container.innerHTML = '<div class="text-sm text-gray-400">æš‚æ— è®°å½•</div>';
                return;
            }

            container.innerHTML = todayHistory.map((item, idx) => `
                <div class="text-sm p-2 bg-gray-50 rounded">
                    <div class="font-medium">${idx + 1}. ${item.title}</div>
                    <div class="text-xs text-gray-500">${item.category} â€¢ ${item.time}</div>
                </div>
            `).join('');
        }

        // å•æ¡ç”Ÿæˆ
        async function generateContent() {
            const rawInput = document.getElementById('rawInput').value.trim();
            const category = document.getElementById('categorySelect').value;
            const btn = document.getElementById('generateBtn');
            const previewArea = document.getElementById('previewArea');

            if (!rawInput) {
                alert('è¯·è¾“å…¥æ–°é—»å†…å®¹');
                return;
            }

            btn.textContent = 'ç”Ÿæˆä¸­...';
            btn.disabled = true;
            previewArea.innerHTML = '<div class="loading text-center py-12 text-gray-400">AI æ­£åœ¨ç”Ÿæˆ...</div>';

            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1000,
                        messages: [{
                            role: 'user',
                            content: `ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å•†ä¸šæƒ…æŠ¥åˆ†æå¸ˆã€‚è¯·åŸºäºä»¥ä¸‹åŸå§‹æ–°é—»å†…å®¹ï¼Œç”Ÿæˆä¸€ä»½ç»“æ„åŒ–çš„æƒ…æŠ¥å¡ç‰‡ã€‚

åŸå§‹æ–°é—»ï¼š
${rawInput}

åˆ†ç±»ï¼š${getCategoryLabel(category)}

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¾“å‡ºï¼ˆä¸è¦åŒ…å«ä»»ä½•å…¶ä»–æ–‡å­—ï¼Œåªè¾“å‡ºçº¯JSONï¼‰ï¼š

{
  "title": "æ ‡é¢˜ï¼ˆ20å­—ä»¥å†…ï¼‰",
  "summary": "ä¸€å¥è¯æ ¸å¿ƒæ‘˜è¦ï¼ˆ30å­—ä»¥å†…ï¼‰",
  "points": ["è¦ç‚¹1", "è¦ç‚¹2", "è¦ç‚¹3"],
  "actions": ["å¯¹åˆ›ä¸šè€…çš„å»ºè®®1", "å»ºè®®2"],
  "risk": "é£é™©æˆ–ä¸ç¡®å®šæ€§æç¤ºï¼ˆä¸€å¥è¯ï¼‰"
}`
                        }]
                    })
                });

                const data = await response.json();
                const text = data.content.find(item => item.type === 'text')?.text || '';
                
                // æ¸…ç†å¯èƒ½çš„markdownæ ‡è®°
                const cleanText = text.replace(/```json|```/g, '').trim();
                const result = JSON.parse(cleanText);

                // æ·»åŠ å…ƒæ•°æ®
                const item = {
                    id: Date.now(),
                    category: category,
                    ...result,
                    importance: 85,
                    source: 'æ‰‹åŠ¨æ·»åŠ ',
                    time: new Date().toLocaleString('zh-CN')
                };

                generatedItems = [item];
                displayPreview();
                updateJSON();
                
                // ä¿å­˜åˆ°å†å²
                todayHistory.push({ title: item.title, category: getCategoryLabel(category), time: new Date().toLocaleTimeString('zh-CN') });
                localStorage.setItem('todayHistory', JSON.stringify(todayHistory));
                updateHistory();

            } catch (error) {
                previewArea.innerHTML = `<div class="text-red-600 text-sm">ç”Ÿæˆå¤±è´¥ï¼š${error.message}</div>`;
                console.error(error);
            }

            btn.textContent = 'AI ç”Ÿæˆç»“æ„åŒ–å†…å®¹';
            btn.disabled = false;
        }

        // æ‰¹é‡ç”Ÿæˆ
        async function generateBatch() {
            const batchInput = document.getElementById('batchInput').value.trim();
            const btn = document.getElementById('batchBtn');
            const previewArea = document.getElementById('previewArea');

            if (!batchInput) {
                alert('è¯·è¾“å…¥æ–°é—»åˆ—è¡¨');
                return;
            }

            btn.textContent = 'æ‰¹é‡ç”Ÿæˆä¸­...';
            btn.disabled = true;
            previewArea.innerHTML = '<div class="loading text-center py-12 text-gray-400">AI æ­£åœ¨æ‰¹é‡ç”Ÿæˆ...</div>';

            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 2000,
                        messages: [{
                            role: 'user',
                            content: `ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å•†ä¸šæƒ…æŠ¥åˆ†æå¸ˆã€‚è¯·åŸºäºä»¥ä¸‹æ–°é—»åˆ—è¡¨ï¼Œä¸ºæ¯æ¡æ–°é—»ç”Ÿæˆç»“æ„åŒ–æƒ…æŠ¥å¡ç‰‡ã€‚

æ–°é—»åˆ—è¡¨ï¼š
${batchInput}

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ•°ç»„æ ¼å¼è¾“å‡ºï¼ˆä¸è¦åŒ…å«ä»»ä½•å…¶ä»–æ–‡å­—ï¼Œåªè¾“å‡ºçº¯JSONæ•°ç»„ï¼‰ï¼š

[
  {
    "category": "ai|trade|policy|cn-finance|global-finance",
    "title": "æ ‡é¢˜ï¼ˆ20å­—ä»¥å†…ï¼‰",
    "summary": "ä¸€å¥è¯æ ¸å¿ƒæ‘˜è¦ï¼ˆ30å­—ä»¥å†…ï¼‰",
    "points": ["è¦ç‚¹1", "è¦ç‚¹2", "è¦ç‚¹3"],
    "actions": ["å¯¹åˆ›ä¸šè€…çš„å»ºè®®1", "å»ºè®®2"],
    "risk": "é£é™©æç¤º"
  },
  ...
]

æ³¨æ„ï¼š
- è‡ªåŠ¨åˆ¤æ–­æ¯æ¡æ–°é—»çš„åˆ†ç±»
- ç¡®ä¿æ¯ä¸ªå­—æ®µéƒ½å®Œæ•´
- å»ºè®®è¦åŠ¡å®ã€å¯æ‰§è¡Œ`
                        }]
                    })
                });

                const data = await response.json();
                const text = data.content.find(item => item.type === 'text')?.text || '';
                const cleanText = text.replace(/```json|```/g, '').trim();
                const results = JSON.parse(cleanText);

                generatedItems = results.map((item, idx) => ({
                    id: Date.now() + idx,
                    ...item,
                    importance: 80,
                    source: 'æ‰¹é‡ç”Ÿæˆ',
                    time: new Date().toLocaleString('zh-CN')
                }));

                displayPreview();
                updateJSON();

                // ä¿å­˜åˆ°å†å²
                results.forEach(item => {
                    todayHistory.push({ 
                        title: item.title, 
                        category: getCategoryLabel(item.category), 
                        time: new Date().toLocaleTimeString('zh-CN') 
                    });
                });
                localStorage.setItem('todayHistory', JSON.stringify(todayHistory));
                updateHistory();

            } catch (error) {
                previewArea.innerHTML = `<div class="text-red-600 text-sm">æ‰¹é‡ç”Ÿæˆå¤±è´¥ï¼š${error.message}</div>`;
                console.error(error);
            }

            btn.textContent = 'æ‰¹é‡ç”Ÿæˆï¼ˆ3-5æ¡ï¼‰';
            btn.disabled = false;
        }

        // æ˜¾ç¤ºé¢„è§ˆ
        function displayPreview() {
            const previewArea = document.getElementById('previewArea');
            
            previewArea.innerHTML = generatedItems.map(item => `
                <div class="preview-card p-4 bg-gray-50 rounded-lg">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs font-semibold text-gray-600">${getCategoryLabel(item.category)}</span>
                        <span class="text-xs text-gray-500">${item.importance}åˆ†</span>
                    </div>
                    <h3 class="font-semibold mb-2">${item.title}</h3>
                    <p class="text-sm text-gray-600 mb-3">${item.summary}</p>
                    
                    <div class="text-xs space-y-2">
                        <div>
                            <div class="font-semibold mb-1">è¦ç‚¹ï¼š</div>
                            ${item.points.map(p => `<div class="text-gray-600">â€¢ ${p}</div>`).join('')}
                        </div>
                        <div>
                            <div class="font-semibold mb-1">å»ºè®®ï¼š</div>
                            ${item.actions.map(a => `<div class="text-gray-600">â†’ ${a}</div>`).join('')}
                        </div>
                        <div>
                            <div class="font-semibold mb-1">é£é™©ï¼š</div>
                            <div class="text-gray-600">${item.risk}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // æ›´æ–°JSON
        function updateJSON() {
            const output = {
                date: new Date().toISOString().split('T')[0],
                items: generatedItems.map(item => ({
                    id: `${item.time}-${item.id}`,
                    category: item.category,
                    title: item.title,
                    tldr: item.summary,
                    keyPoints: item.points,
                    actionable: item.actions,
                    risk: item.risk,
                    importance: item.importance,
                    impact: 'positive',
                    source: item.source,
                    sourceUrl: '#',
                    publishedAt: new Date().toISOString()
                }))
            };

            document.getElementById('jsonOutput').value = JSON.stringify(output, null, 2);
        }

        // å¤åˆ¶JSON
        function copyJSON() {
            const jsonText = document.getElementById('jsonOutput').value;
            if (!jsonText || jsonText === '') {
                alert('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹');
                return;
            }

            navigator.clipboard.writeText(jsonText).then(() => {
                const btn = document.getElementById('copyBtn');
                const originalText = btn.textContent;
                btn.textContent = 'å·²å¤åˆ¶ï¼';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            });
        }

        function getCategoryLabel(category) {
            const labels = {
                'ai': 'AIåˆ›æ–°',
                'trade': 'ä¸­å¤–è´¸æ˜“',
                'policy': 'å›½å†…æ”¿ç­–',
                'cn-finance': 'ä¸­å›½é‡‘è',
                'global-finance': 'æµ·å¤–é‡‘è'
            };
            return labels[category] || category;
        }

        // åˆå§‹åŒ–
        updateHistory();

        // ===== é‚®ä»¶æ¨é€åŠŸèƒ½ =====
        
        // ç”Ÿæˆé‚®ä»¶HTMLå†…å®¹
        function generateEmailHTML(items) {
            const date = new Date().toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' });
            
            const itemsHTML = items.slice(0, 5).map((item, idx) => `
                <div style="margin-bottom: 24px; padding: 20px; background: #f9f9f9; border-radius: 8px;">
                    <div style="color: #666; font-size: 12px; margin-bottom: 8px;">
                        ${getCategoryLabel(item.category)}
                    </div>
                    <h3 style="margin: 0 0 8px 0; font-size: 18px; color: #000;">
                        ${idx + 1}. ${item.title}
                    </h3>
                    <p style="margin: 0 0 12px 0; color: #333; font-size: 14px;">
                        <strong>æ ¸å¿ƒï¼š</strong>${item.summary}
                    </p>
                    <div style="font-size: 13px; color: #555; line-height: 1.6;">
                        <strong>è¦ç‚¹ï¼š</strong>
                        <ul style="margin: 8px 0; padding-left: 20px;">
                            ${item.points.map(p => `<li>${p}</li>`).join('')}
                        </ul>
                        <strong>å»ºè®®ï¼š</strong>
                        <ul style="margin: 8px 0; padding-left: 20px;">
                            ${item.actions.map(a => `<li>${a}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `).join('');

            return `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
    <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
        <div style="text-align: center; padding: 20px 0; border-bottom: 2px solid #000;">
            <h1 style="margin: 0; font-size: 24px;">ğŸ“Š åˆ›ä¸šè€…æƒ…æŠ¥</h1>
            <p style="margin: 8px 0 0 0; color: #666; font-size: 14px;">${date}</p>
        </div>
        
        <div style="padding: 24px 0;">
            <div style="background: #000; color: #fff; padding: 20px; border-radius: 8px; margin-bottom: 24px;">
                <h2 style="margin: 0 0 8px 0; font-size: 16px; opacity: 0.8;">ä»Šæ—¥æ ¸å¿ƒæ´å¯Ÿ</h2>
                <p style="margin: 0; font-size: 15px; line-height: 1.6;">
                    ç¾è”å‚¨æš‚åœåŠ æ¯é¢„æœŸå‡æ¸©ï¼ŒAIç›‘ç®¡æ”¿ç­–è½åœ°ï¼Œç§‘æŠ€è‚¡çŸ­æœŸçœ‹æ¶¨ã€‚å»ºè®®å…³æ³¨AIåº”ç”¨è½åœ°æœºä¼šã€‚
                </p>
            </div>

            <h2 style="font-size: 18px; margin-bottom: 16px;">ä»Šæ—¥ç²¾é€‰ Top 5</h2>
            ${itemsHTML}
        </div>

        <div style="text-align: center; padding: 20px 0; border-top: 1px solid #e5e5e5; color: #999; font-size: 12px;">
            <p>åˆ›ä¸šè€…æƒ…æŠ¥ä¸­å¿ƒ Â© 2026</p>
            <p style="margin-top: 8px;">
                <a href="https://your-site.com" style="color: #000; text-decoration: none;">è®¿é—®å®Œæ•´ç‰ˆ</a>
            </p>
        </div>
    </div>
</body>
</html>
            `;
        }

        // ä½¿ç”¨ EmailJS å‘é€é‚®ä»¶ï¼ˆéœ€è¦å…ˆé…ç½® EmailJS è´¦æˆ·ï¼‰
        async function sendEmail(toEmail, subject, htmlContent) {
            // è¿™é‡Œä½¿ç”¨ EmailJS æœåŠ¡ï¼ˆå…è´¹é¢åº¦ï¼š200å°/æœˆï¼‰
            // éœ€è¦åœ¨ https://www.emailjs.com/ æ³¨å†Œå¹¶é…ç½®
            
            // ä¸´æ—¶æ–¹æ¡ˆï¼šä½¿ç”¨ mailto é“¾æ¥ï¼ˆæµè§ˆå™¨æ‰“å¼€é‚®ä»¶å®¢æˆ·ç«¯ï¼‰
            const textContent = 'è¯·åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹HTMLé‚®ä»¶';
            
            // å®é™…éƒ¨ç½²æ—¶ï¼Œåº”è¯¥ä½¿ç”¨åç«¯æœåŠ¡å‘é€é‚®ä»¶
            // è¿™é‡Œæä¾›ä¸€ä¸ªç¤ºä¾‹ç»“æ„
            console.log('å‡†å¤‡å‘é€é‚®ä»¶åˆ°:', toEmail);
            console.log('é‚®ä»¶å†…å®¹:', htmlContent);
            
            return {
                success: true,
                message: 'é‚®ä»¶å·²å‡†å¤‡å¥½ï¼Œå®é™…éƒ¨ç½²éœ€è¦é…ç½®é‚®ä»¶æœåŠ¡'
            };
        }

        // æµ‹è¯•å‘é€é‚®ä»¶
        async function testEmail() {
            const email = document.getElementById('emailInput').value;
            
            if (!email) {
                alert('è¯·è¾“å…¥é‚®ç®±åœ°å€');
                return;
            }

            // ä½¿ç”¨å½“å‰ç”Ÿæˆçš„å†…å®¹æˆ–ç¤ºä¾‹æ•°æ®
            const items = generatedItems.length > 0 ? generatedItems : [
                {
                    category: 'ai',
                    title: 'OpenAI GPT-5 å¼€å¯å†…æµ‹',
                    summary: 'æ€§èƒ½æå‡300%ï¼Œæˆæœ¬é™40%',
                    points: ['APIæˆæœ¬é™ä½40%', 'ä»£ç ç”Ÿæˆå‡†ç¡®ç‡92%', 'é•¿è§†é¢‘ç†è§£èƒ½åŠ›'],
                    actions: ['è¯„ä¼°ä¸šåŠ¡AIåŒ–å¯èƒ½æ€§', 'è§„åˆ’åŸºäºGPT-5çš„æ–°äº§å“']
                }
            ];

            const html = generateEmailHTML(items);
            
            // æ‰“å¼€é¢„è§ˆçª—å£
            const preview = window.open('', 'EmailPreview', 'width=600,height=800');
            preview.document.write(html);
            preview.document.close();
            
            alert('âœ… é‚®ä»¶é¢„è§ˆå·²æ‰“å¼€ï¼\n\nå®é™…éƒ¨ç½²æ—¶å°†è‡ªåŠ¨å‘é€åˆ°: ' + email);
        }

        // ä¿å­˜é‚®ä»¶è®¾ç½®
        function saveEmailSettings() {
            const email = document.getElementById('emailInput').value;
            const time = document.getElementById('pushTime').value;
            
            if (!email) {
                alert('è¯·è¾“å…¥é‚®ç®±åœ°å€');
                return;
            }

            localStorage.setItem('emailSettings', JSON.stringify({ email, time }));
            alert('âœ… è®¾ç½®å·²ä¿å­˜ï¼\n\né‚®ç®±: ' + email + '\næ¨é€æ—¶é—´: æ¯å¤©' + time);
        }

        // åŠ è½½ä¿å­˜çš„é‚®ä»¶è®¾ç½®
        const savedEmail = localStorage.getItem('emailSettings');
        if (savedEmail) {
            const settings = JSON.parse(savedEmail);
            document.getElementById('emailInput').value = settings.email;
            document.getElementById('pushTime').value = settings.time;
        }
    </script>
</body>
</html>
